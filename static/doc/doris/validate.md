# 接口验证

Doris的数据模版不仅可以用于数据生成，而且还可以用于验证真实接口数据。 这在测试阶段非常有用，可以自动发现后台返回数据和模版、文档不一致的情况，减少排错时间。doris接口验证有三个层面：

1. 字段验证
2. 类型验证
3. 取值范围验证

## 使用

在使用验证功能时只需将真实的后台接口基地址补充到Doris下对应的工程信息中，Doris会自动生成验证基地址，客户端通过验证基地址请求数据即可，如果验证成功，则返回接口数据，如果失败，则返回错误码为666的错误，同时errorMsg字段为具体的错误信息。

### 字段验证

字段验证是将真实的接口字段和数据模版比较，检查是否缺少或有多余的字段（数据模版中为定义，但真实接口中有）。

### 类型验证

主要验证接口中的字段值类型是否和模版中的一致，doris验证的类型有如下几种

1. Number 
2. String
3. Boolean
4. Array
5. Object

**注：**

1. doris中不区分浮点数和整形、也不区分长整型，所有的数值类型都会被当作number类型，如果数据模版中某个字段是一个int，而实际接口传了一个float，**doris并不会报错**。

2. 数据模版中值包含占位符时，触发类型验证的条件是值中**有且仅有一个占位符**，否则一律当成string类型验证：

   ```javascript
   {
     "count":"@int(1,10)",  //count能正常作为number类型验证
     "type":"xx@int(1,10)"  //值中除过占位符还有其它字符，type会被当作string类型
     "age":"@int@bool" //值中包含多个占位符，age会被当作string类型
   }
   ```

   之所以有这个限制是因为如果有多个占位符时doris在生成数据的时候会将多个占位符返回值当作字符串拼接处理，对于其他人字符和占位符混用的情况也是相同的。

### 取值范围验证

doris中只对**显示指定**了取值范围的字段进行范围验证，**值为占位符的字段不做范围验证**，这是因为占位符函数生成的数据一般都是随机的，很多时候我们只是想用它生成一些不同的值，而不是用它来指定范围。目前显示doris中显示指定取值范围的情况只有一种：

`"字段名|1",[...]`

表示该字段的取值是数组中的一个，如：

```javascript
{
  "productType|1":[13,15,17]
}
```







