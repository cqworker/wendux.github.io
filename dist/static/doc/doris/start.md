# 使用

### 第一步：添加应用

首先要在 Doris 中添加一个应用，添加之后，doris为该应用自动创建一个默认的接口版本 1.0.0。应用信息在创建完成后可以随时修改。值得注意的是应用信息中有个选填的**服务基地址**字段，它代表的是真正的后台接口基地址，只有提供真正的接口地址，doris 的**接口验证**功能才能生效。

### 第二步：添加版本

Doris 中接口是有版本控制的，接口都属于某一个版本。创建新版本时可以从之前的任何版本fork，它会将要 fork的版本的所有接口克隆过来。不同版本之间的接口时相互独立的，也就是说，对于统一个接口，你在2.0.0版本修改了，它不会影响1.0.0的接口。版本支持删除操作，删除某个版本之后，该版本的所有接口数据也**都将被删除**，Doris 在创建应用时会自动创建一个默认的1.0.0版本，该版本为初始版本，不能被删除。

### 第三步：添加接口

接下来你就可以给版本添加接口，一个接口由四个基本字段组成

| 字段名  | 描述                                       |
| ---- | ---------------------------------------- |
| 名称   | 接口的简单描述，如"登录"、"用户信息"等。                   |
| 路径   | 接口的path，和后台实际的path要保持一致，如 "/login"、“/user/info” |
| 数据模版 | 接口返回数据的模版，支持mock语法。详情参考 [数据模版定义](#/doc/doris/data-mock) 。 |
| 文档   | 接口的说明，支持markdown语法。                      |



**路径匹配：**

接口路径即请求的 path，必须和真正后台的path保持一致。我们知道，path 中也是可以传参数的，如：

```javascript
//id为用户id,是一个动态参数
/user/info/{id}
```

Doris支持路径参数，你只需将参数用花括号括起来即可。正如上面的例子，以下的请求都将会被匹配：

```javascript
/user/info/3
/user/info/5
/user/info/name
```



**匹配优先级**

在上面的例子中，如果我们也单独创建了一个path为 `/user/info/name` 的接口，那么此时客户端在请求  `/user/info/name` 时会匹配 `/user/info/{id}` 还是 `/user/info/name` ？ 答案是后者，Doris的匹配规则是**优先精确匹配，然后才会进行通配符匹配**。



## 前端使用

Doris会为每个应用的每个版本都会生成一个**数据模拟基地址**，前端只要将请求基地址替换为该地址，再通过path请求即可得到 Doris 根据数据模版生成的模拟数据，如何定义数据模版请参考  [数据模版定义](#/doc/doris/data-mock) 。

在测试阶段时，后台的接口也就开发完成了，此时，将真正后台服务的基地址填到Doris **服务基地址**，Doris 就会生成一个 **接口验证基地址**，前端只需将请求基地址换成 **接口验证基地址**便可使用Doris的接口验证功能。

### 接口验证原理

前端将请求基地址换为 doris 生成的**接口验证基地址**后，doris在收到前端的请求后，首先会转发给真正的后台，获取到后台的返回数据后，doris再根据请求path，取出之前定义好的数据模版，验证后台数据是否匹配，如果匹配，则将后台数据直接返回，如果不匹配，则会返回一个错误信息，结构如下：

```javascript
{
  errCode:667,
  data: 后台返回的数据
  errMsg:"" //错误信息
}
```

错误信息

| 错误码  | 含义                         |
| ---- | -------------------------- |
| 666  | doris错误，如无匹配的path、数据模版格式错误 |
| 667  | 接口验证错误。                    |



关于接口验证，详细的内容请参考 [接口验证](#/doc/doris/validate) 。